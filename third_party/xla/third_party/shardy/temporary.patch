diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch
index ff478d6..330ee97 100644
--- a/third_party/llvm/generated.patch
+++ b/third_party/llvm/generated.patch
@@ -1,240 +1,62 @@
 Auto generated patch. Do not edit or delete it, even if empty.
-diff -ruN --strip-trailing-cr a/clang/lib/Driver/ToolChains/Clang.cpp b/clang/lib/Driver/ToolChains/Clang.cpp
---- a/clang/lib/Driver/ToolChains/Clang.cpp
-+++ b/clang/lib/Driver/ToolChains/Clang.cpp
-@@ -1065,10 +1065,6 @@
-     A->render(Args, CmdArgs);
-   }
- 
--  Args.addAllArgs(CmdArgs,
--                  {options::OPT_D, options::OPT_U, options::OPT_I_Group,
--                   options::OPT_F, options::OPT_embed_dir_EQ});
--
-   if (C.isOffloadingHostKind(Action::OFK_Cuda) ||
-       JA.isDeviceOffloading(Action::OFK_Cuda)) {
-     // Collect all enabled NVPTX architectures.
-@@ -1091,6 +1087,10 @@
-     }
-   }
- 
-+  Args.addAllArgs(CmdArgs,
-+                  {options::OPT_D, options::OPT_U, options::OPT_I_Group,
-+                   options::OPT_F, options::OPT_embed_dir_EQ});
-+
-   // Add -Wp, and -Xpreprocessor if using the preprocessor.
- 
-   // FIXME: There is a very unfortunate problem here, some troubled
-diff -ruN --strip-trailing-cr a/clang/lib/Serialization/ASTReaderDecl.cpp b/clang/lib/Serialization/ASTReaderDecl.cpp
---- a/clang/lib/Serialization/ASTReaderDecl.cpp
-+++ b/clang/lib/Serialization/ASTReaderDecl.cpp
-@@ -3642,9 +3642,23 @@
- void ASTDeclReader::attachPreviousDeclImpl(ASTReader &Reader,
-                                            Redeclarable<VarDecl> *D,
-                                            Decl *Previous, Decl *Canon) {
-+  auto *VD = static_cast<VarDecl *>(D);
-   auto *PrevVD = cast<VarDecl>(Previous);
-   D->RedeclLink.setPrevious(PrevVD);
-   D->First = PrevVD->First;
-+
-+  // We should keep at most one definition on the chain.
-+  // FIXME: Cache the definition once we've found it. Building a chain with
-+  // N definitions currently takes O(N^2) time here.
-+  if (VD->isThisDeclarationADefinition() == VarDecl::Definition) {
-+    for (VarDecl *CurD = PrevVD; CurD; CurD = CurD->getPreviousDecl()) {
-+      if (CurD->isThisDeclarationADefinition() == VarDecl::Definition) {
-+        Reader.mergeDefinitionVisibility(CurD, VD);
-+        VD->demoteThisDefinitionToDeclaration();
-+        break;
-+      }
-+    }
-+  }
+diff -ruN --strip-trailing-cr a/libc/src/__support/wchar/character_converter.h b/libc/src/__support/wchar/character_converter.h
+--- a/libc/src/__support/wchar/character_converter.h
++++ b/libc/src/__support/wchar/character_converter.h
+@@ -77,7 +77,8 @@
  }
  
- static bool isUndeducedReturnType(QualType T) {
-diff -ruN --strip-trailing-cr a/clang/test/Driver/cuda-arch-list.cu b/clang/test/Driver/cuda-arch-list.cu
---- a/clang/test/Driver/cuda-arch-list.cu
-+++ b/clang/test/Driver/cuda-arch-list.cu
-@@ -23,6 +23,11 @@
- // RUN:   --offload-arch=sm_60 --offload-arch=sm_70 --no-offload-arch=sm_60 %s 2>&1 \
- // RUN: | FileCheck -check-prefixes=DEVICE70-ONLY,HOST70-ONLY %s
+ LIBC_INLINE int CharacterConverter::push(char8_t utf8_byte) {
+-  uint8_t num_ones = static_cast<uint8_t>(cpp::countl_one(utf8_byte));
++  uint8_t num_ones =
++      static_cast<uint8_t>(cpp::countl_one(static_cast<uint8_t>(utf8_byte)));
+   // Checking the first byte if first push
+   if (isEmpty()) {
+     // UTF-8 char has 1 byte total
+diff -ruN --strip-trailing-cr a/llvm/lib/Transforms/Instrumentation/MemProfUse.cpp b/llvm/lib/Transforms/Instrumentation/MemProfUse.cpp
+--- a/llvm/lib/Transforms/Instrumentation/MemProfUse.cpp
++++ b/llvm/lib/Transforms/Instrumentation/MemProfUse.cpp
+@@ -910,11 +910,8 @@
  
-+// Verify that user-specified -D__CUDA_ARCH_LIST__ overrides the driver-generated one
-+// RUN: %clang -### --target=x86_64-unknown-linux-gnu -nocudainc -nocudalib \
-+// RUN:   --offload-arch=sm_60 -D__CUDA_ARCH_LIST__=999 %s 2>&1 \
-+// RUN: | FileCheck -check-prefixes=DEVICE-OVERRIDE,HOST-OVERRIDE %s
-+
- // DEVICE60: "-cc1" "-triple" "nvptx64-nvidia-cuda"
- // DEVICE60-SAME: "-target-cpu" "sm_60"
- // DEVICE60-SAME: "-D__CUDA_ARCH_LIST__=600"
-@@ -54,3 +59,12 @@
- 
- // HOST70-ONLY: "-cc1" "-triple" "x86_64-unknown-linux-gnu"
- // HOST70-ONLY-SAME: "-D__CUDA_ARCH_LIST__=700"
+   if (!DataAccessProf) {
+     M.addModuleFlag(Module::Warning, "EnableDataAccessProf", 0U);
+-    M.getContext().diagnose(DiagnosticInfoPGOProfile(
+-        MemoryProfileFileName.data(),
+-        StringRef("Data access profiles not found in memprof. Ignore "
+-                  "-memprof-annotate-static-data-prefix."),
+-        DS_Warning));
++    // FIXME: Add a diagnostic message without failing the compilation when
++    // data access profile payload is not available.
+     return false;
+   }
+   M.addModuleFlag(Module::Warning, "EnableDataAccessProf", 1U);
+diff -ruN --strip-trailing-cr a/llvm/test/CodeGen/AArch64/fptoi-256.ll b/llvm/test/CodeGen/AArch64/fptoi-256.ll
+--- a/llvm/test/CodeGen/AArch64/fptoi-256.ll
++++ b/llvm/test/CodeGen/AArch64/fptoi-256.ll
+@@ -0,0 +1,11 @@
++; RUN: llc -mtriple=aarch64 < %s
 +
-+// DEVICE-OVERRIDE: "-cc1" "-triple" "nvptx64-nvidia-cuda"
-+// DEVICE-OVERRIDE-SAME: "-target-cpu" "sm_60"
-+// DEVICE-OVERRIDE-SAME: "-D__CUDA_ARCH_LIST__=600"
-+// DEVICE-OVERRIDE-SAME: "-D" "__CUDA_ARCH_LIST__=999"
++define i256 @doubletosi256(double %a) {
++  %conv = fptosi double %a to i256
++  ret i256 %conv
++}
 +
-+// HOST-OVERRIDE: "-cc1" "-triple" "x86_64-unknown-linux-gnu"
-+// HOST-OVERRIDE-SAME: "-D__CUDA_ARCH_LIST__=600"
-+// HOST-OVERRIDE-SAME: "-D" "__CUDA_ARCH_LIST__=999"
-diff -ruN --strip-trailing-cr a/clang/test/Modules/pr149404-02.cppm b/clang/test/Modules/pr149404-02.cppm
---- a/clang/test/Modules/pr149404-02.cppm
-+++ b/clang/test/Modules/pr149404-02.cppm
-@@ -1,104 +0,0 @@
--// RUN: rm -rf %t
--// RUN: mkdir -p %t
--// RUN: split-file %s %t
--
--// RUN: %clang_cc1 -std=c++20 -emit-module-interface -o %t/format.pcm %t/format.cppm
--// RUN: %clang_cc1 -std=c++20  -emit-module-interface -o %t/includes_in_gmf.pcm %t/includes_in_gmf.cppm
--// RUN: %clang_cc1 -std=c++20 -fprebuilt-module-path=%t %t/test.cpp -verify -fsyntax-only
--
--// RUN: %clang_cc1 -std=c++20 -emit-reduced-module-interface -o %t/format.pcm %t/format.cppm
--// RUN: %clang_cc1 -std=c++20  -emit-reduced-module-interface -o %t/includes_in_gmf.pcm %t/includes_in_gmf.cppm
--// RUN: %clang_cc1 -std=c++20 -fprebuilt-module-path=%t %t/test.cpp -verify -fsyntax-only
--
--//--- format.h
--#pragma once
--
--namespace test {
--
--template <class _Tp>
--struct type_identity {
--    typedef _Tp type;
--};
--
--template <class _Tp>
--using type_identity_t = typename type_identity<_Tp>::type;
--
--
--template <class _Tp, class _CharT>
--struct formatter
--{
--    formatter() = delete;
--};
--
--template <>
--struct formatter<char, char>
--{};
--
--template <class _CharT, class... _Args>
--struct basic_format_string {
--    static inline const int __handles_{ [] {
--        formatter<char, _CharT> f;
--        (void)f;
--        return 0;
--        }() };
--    
--    consteval basic_format_string(const _CharT*) {
--        (void)__handles_;
--    }
--};
--
--template <class... _Args>
--using wformat_string = basic_format_string<wchar_t, type_identity_t<_Args>...>;
--
--template <class... _Args>
--using format_string = basic_format_string<char, type_identity_t<_Args>...>;
--
--template <class... _Args>
--void format(format_string<_Args...> __fmt, _Args&&... __args) {}
--
--template <class... _Args>
--void format(wformat_string<_Args...> __fmt, _Args&&... __args) {}
--
--}
--
--//--- format.cppm
--module;
--#include "format.h"
--export module format;
--
--export namespace test {
--	using test::format;
--	using test::formatter;
--	using test::format_string;
--}
--
--auto something() -> void
--{
--	auto a = 'a';
--	test::format("{}", a);
--}
--
--//--- includes_in_gmf.cppm
--module;
--#include "format.h"
--export module includes_in_gmf;
--
--namespace test {
--	using test::format;
--	using test::formatter;
--	using test::format_string;
++define double @si256todouble(i256 %a) {
++  %conv = sitofp i256 %a to double
++  ret double %conv
++}
+diff -ruN --strip-trailing-cr a/llvm/test/CodeGen/fptoi-256.ll b/llvm/test/CodeGen/fptoi-256.ll
+--- a/llvm/test/CodeGen/fptoi-256.ll
++++ b/llvm/test/CodeGen/fptoi-256.ll
+@@ -1,12 +0,0 @@
+-; REQUIRES: aarch64-registered-target
+-; RUN: llc -mtriple=aarch64 < %s
+-
+-define i256 @doubletosi256(double %a) {
+-  %conv = fptosi double %a to i256
+-  ret i256 %conv
 -}
 -
--//--- test.cpp
--// expected-no-diagnostics
--import format;
--import includes_in_gmf;
--
--auto what() -> void
--{
--    auto a = 'a';
--    test::format("{}", a);
--
--    constexpr auto fs = "{}"; // test::format_string<char>{ "{}" }; // <- same result even passing exact param type
--    test::format(fs, 'r');
+-define double @si256todouble(i256 %a) {
+-  %conv = sitofp i256 %a to double
+-  ret double %conv
 -}
-diff -ruN --strip-trailing-cr a/clang/test/Modules/pr172241.cppm b/clang/test/Modules/pr172241.cppm
---- a/clang/test/Modules/pr172241.cppm
-+++ b/clang/test/Modules/pr172241.cppm
-@@ -1,47 +0,0 @@
--// RUN: rm -rf %t
--// RUN: mkdir -p %t
--// RUN: split-file %s %t
--//
--// RUN: %clang_cc1 -std=c++20 -triple %itanium_abi_triple %t/m.cppm -emit-module-interface -o %t/m.pcm
--// RUN: %clang_cc1 -std=c++20 -triple %itanium_abi_triple %t/use.cpp -fmodule-file=m=%t/m.pcm -emit-llvm -o - | FileCheck %t/use.cpp
--//
--// RUN: %clang_cc1 -std=c++20 -triple %itanium_abi_triple %t/m.cppm -emit-reduced-module-interface -o %t/m.pcm
--// RUN: %clang_cc1 -std=c++20 -triple %itanium_abi_triple %t/use.cpp -fmodule-file=m=%t/m.pcm -emit-llvm -o - | FileCheck %t/use.cpp
--
--//--- header.h
--#pragma once
--
--template <unsigned T>
--class Templ {
--public:
--    void lock() { __set_locked_bit(); }
--
--private:
--    static constexpr auto __set_locked_bit = [](){};
--};
--
--class JT {
--public:
--    ~JT() {
--        Templ<4> state;
--        state.lock();
--    }
--};
--
--//--- m.cppm
--module;
--#include "header.h"
--export module m;
--export struct M {
--    JT jt;
--};
--//--- use.cpp
--#include "header.h"
--import m;
--
--int main() {
--    M m;
--    return 0;
--}
--
--// CHECK: @_ZN5TemplILj4EE16__set_locked_bitE = {{.*}}linkonce_odr
diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl
index 9e70e35..a9af7d2 100644
--- a/third_party/llvm/workspace.bzl
+++ b/third_party/llvm/workspace.bzl
@@ -4,8 +4,8 @@ load("//third_party:repo.bzl", "tf_http_archive")
 
 def repo(name):
     """Imports LLVM."""
-    LLVM_COMMIT = "01e6245af481dac4604e8a25be6bec0dbe36f99d"
-    LLVM_SHA256 = "3387b340f1734dca6544e043c53c9964545e2a4b6e9c426c84a23ad914b7047c"
+    LLVM_COMMIT = "ec28be3ccac432ea6a45eca67249b209be216c0a"
+    LLVM_SHA256 = "f817108a98dc666bbf5590743670ee0d529ad6ddb4afd659b11540d2834ecb28"
 
     tf_http_archive(
         name = name,
